<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BACFLIX Planner Pro 2.0</title>
<style>
/* ===========================
   VARIABLES & RESET
=========================== */
:root {
  --red:      #e50914;
  --red-dk:   #b20710;
  --red-glow: rgba(229,9,20,.28);
  --bg:       #080808;
  --s0:       #000;
  --s1:       #111;
  --s2:       #181818;
  --s3:       #222;
  --s4:       #2c2c2c;
  --s5:       #3a3a3a;
  --border:   #2a2a2a;
  --text:     #e5e5e5;
  --dim:      #aaa;
  --muted:    #666;
  --green:    #46d369;
  --yellow:   #e8b708;
  --orange:   #ff6b00;
  --gold:     #ffc107;
  --radius:   10px;
}
*{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
body{font-family:'Segoe UI',Tahoma,sans-serif;background:var(--bg);color:var(--text);line-height:1.5;min-height:100vh}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-track{background:var(--s1)}
::-webkit-scrollbar-thumb{background:var(--red);border-radius:3px}

/* ===========================
   HEADER
=========================== */
header{
  position:sticky;top:0;z-index:200;
  background:linear-gradient(180deg,#000 60%,rgba(0,0,0,.92));
  border-bottom:2px solid var(--red);
  padding:.7rem 2rem;
  display:flex;justify-content:space-between;align-items:center;gap:1rem;
  backdrop-filter:blur(12px);
}
.logo{font-size:1.9rem;font-weight:900;color:var(--red);letter-spacing:-1px;text-shadow:0 0 22px var(--red-glow);cursor:default}
.logo b{color:#fff}
.brand-meta{font-size:.65rem;color:var(--muted);margin-top:1px}
.hdr-right{display:flex;align-items:center;gap:1.2rem;flex-wrap:wrap}
.streak-pill{display:flex;align-items:center;gap:.4rem;background:var(--s2);border:1px solid var(--orange);padding:.35rem .8rem;border-radius:20px;font-size:.82rem;font-weight:700;color:var(--orange);white-space:nowrap}
.xp-wrap{display:flex;flex-direction:column;align-items:flex-end;gap:3px}
.xp-label{font-size:.68rem;color:var(--muted)}
.xp-bar{width:110px;height:5px;background:var(--s4);border-radius:3px;overflow:hidden}
.xp-fill{height:100%;background:linear-gradient(90deg,var(--red-dk),var(--red));border-radius:3px;transition:width .6s ease}
.lvl-badge{background:var(--red);color:#fff;font-weight:700;font-size:.78rem;padding:.28rem .6rem;border-radius:5px;min-width:38px;text-align:center}

/* ===========================
   QUOTE BAR
=========================== */
.quote-bar{background:linear-gradient(135deg,#130000,#0a0000);border-bottom:1px solid var(--s4);padding:.45rem 2rem;text-align:center;font-size:.78rem;color:var(--muted);font-style:italic}
.quote-bar em{color:var(--red);font-style:normal}
#quoteText{transition:opacity .6s}

/* ===========================
   LAYOUT
=========================== */
.container{max-width:1520px;margin:1.5rem auto;padding:0 1.2rem;display:grid;grid-template-columns:295px 1fr;gap:1.4rem}
@media(max-width:900px){.container{grid-template-columns:1fr}header{padding:.7rem 1rem}}

/* ===========================
   SIDEBAR CARDS
=========================== */
.sidebar{display:flex;flex-direction:column;gap:.9rem}
.card{background:var(--s1);border:1px solid var(--border);border-radius:var(--radius);padding:1.1rem;animation:slideIn .4s ease}
.card-t{font-size:.78rem;font-weight:700;color:var(--red);margin-bottom:.9rem;display:flex;align-items:center;gap:.4rem;text-transform:uppercase;letter-spacing:.5px}

select{
  width:100%;padding:.65rem 1rem .65rem 2rem;background:var(--s3);
  border:1px solid var(--border);border-radius:7px;color:var(--text);
  cursor:pointer;font-size:.88rem;transition:border-color .2s;
  appearance:none;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='11' height='11' fill='%23e50914' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
  background-repeat:no-repeat;background-position:12px center;
}
select:focus{outline:none;border-color:var(--red)}

.subj-list{max-height:310px;overflow-y:auto;display:flex;flex-direction:column;gap:.45rem;padding-left:2px}
.subj-row{background:var(--s3);border-radius:7px;padding:.55rem .75rem;display:grid;grid-template-columns:1fr 7px auto;gap:.5rem;align-items:center;border:1px solid transparent;transition:border-color .2s;animation:fadeUp .3s ease}
.subj-row:hover{border-color:var(--s5)}
.sn{font-size:.82rem;font-weight:600}
.sc{font-size:.68rem;color:var(--muted);margin-top:1px}
.pri-bar{height:28px;width:7px;border-radius:4px;transition:background .35s;flex-shrink:0}
.lvl-sel{padding:.28rem .35rem;background:var(--s4);border:1px solid var(--border);color:var(--text);border-radius:5px;font-size:.75rem;cursor:pointer;transition:border-color .2s}
.lvl-sel:focus{outline:none;border-color:var(--red)}

/* Generate btn */
.btn-gen{
  width:100%;padding:.85rem;margin-top:.9rem;
  background:linear-gradient(45deg,var(--red-dk),var(--red));
  color:#fff;border:none;border-radius:8px;font-size:.98rem;font-weight:700;
  cursor:pointer;transition:all .3s;display:flex;align-items:center;justify-content:center;gap:.5rem;
  box-shadow:0 4px 18px var(--red-glow);position:relative;overflow:hidden;
}
.btn-gen::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.08),transparent);transition:left .55s}
.btn-gen:hover::before{left:100%}
.btn-gen:hover{transform:translateY(-2px);box-shadow:0 6px 22px rgba(229,9,20,.45)}
.btn-gen:active{transform:translateY(0)}

/* Progress */
.stat-it{margin-bottom:.75rem}
.stat-hd{display:flex;justify-content:space-between;font-size:.75rem;color:var(--dim);margin-bottom:3px}
.stat-val{color:var(--text);font-weight:700}
.prog-bar{height:5px;background:var(--s4);border-radius:3px;overflow:hidden}
.prog-fill{height:100%;border-radius:3px;transition:width .7s cubic-bezier(.4,0,.2,1)}

/* Badges */
.badges-wrap{display:flex;flex-wrap:wrap;gap:.4rem;margin-top:.3rem}
.badge{background:var(--s3);border:1px solid var(--border);padding:.2rem .5rem;border-radius:20px;font-size:.68rem;color:var(--muted);transition:all .3s;cursor:default}
.badge.earned{background:rgba(229,9,20,.12);border-color:var(--red);color:var(--red)}

/* Rules */
.rules-box{background:linear-gradient(135deg,rgba(229,9,20,.04),transparent);border:1px dashed var(--s5);border-radius:8px;padding:.8rem;font-size:.73rem;color:var(--muted)}
.rules-t{color:var(--yellow);font-weight:700;font-size:.78rem;margin-bottom:.45rem}
.rules-box li{margin-bottom:.3rem;padding-right:12px}

/* ===========================
   MAIN CONTENT
=========================== */
.main{display:flex;flex-direction:column;gap:.9rem}

/* Tabs */
.tabs{display:flex;gap:.45rem;background:var(--s1);border:1px solid var(--border);border-radius:var(--radius);padding:.45rem}
.tab-btn{flex:1;padding:.55rem;background:transparent;border:none;color:var(--muted);cursor:pointer;border-radius:7px;font-size:.82rem;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:.35rem}
.tab-btn.active{background:var(--red);color:#fff;font-weight:700}
.tab-btn:hover:not(.active){background:var(--s3);color:var(--text)}
.tab-pane{display:none}
.tab-pane.active{display:block;animation:fadeIn .3s ease}

/* Plan header */
.plan-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:.9rem}
.hdr-acts{display:flex;gap:.45rem}
.btn-sm{padding:.38rem .75rem;background:var(--s3);border:1px solid var(--border);color:var(--text);border-radius:6px;cursor:pointer;font-size:.78rem;transition:all .2s;display:flex;align-items:center;gap:.3rem}
.btn-sm:hover{background:var(--s4);border-color:var(--red);color:var(--red)}

/* Day Grid */
.plan-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(195px,1fr));gap:.9rem}
.day-col{background:var(--s1);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;transition:transform .3s,box-shadow .3s}
.day-col:hover{transform:translateY(-4px);box-shadow:0 8px 28px rgba(0,0,0,.55)}
.day-col.today{border-color:var(--red)}
.day-col.today .day-hdr{background:linear-gradient(135deg,var(--red-dk),var(--red))}
.day-hdr{background:var(--s2);padding:.65rem .8rem;border-bottom:2px solid var(--red);display:flex;justify-content:space-between;align-items:center}
.day-nm{font-weight:700;font-size:.88rem}
.day-ct{font-size:.68rem;color:var(--green)}

/* Slot */
.slot{padding:.65rem .75rem;border-bottom:1px solid var(--border);position:relative;transition:background .2s}
.slot:hover{background:rgba(255,255,255,.018)}
.slot:last-child{border-bottom:none}
.slot.done-slot{opacity:.58}
.slot-time{font-size:.63rem;color:var(--muted);margin-bottom:.25rem;display:flex;align-items:center;gap:.28rem}
.slot-subj{font-weight:700;font-size:.88rem;margin-bottom:.28rem}
.slot-method{font-size:.63rem;padding:.13rem .38rem;border-radius:3px;width:fit-content;margin-bottom:.35rem}
.mh{background:rgba(229,9,20,.14);color:#ff8a80}
.mm{background:rgba(232,183,8,.14);color:#ffe082}
.me{background:rgba(70,211,105,.14);color:#a5d6a7}

/* Stars */
.stars{display:flex;gap:2px;margin-top:.28rem}
.star{color:var(--s5);font-size:.72rem;cursor:pointer;transition:color .15s}
.star.lit{color:var(--gold)}

/* Actions */
.slot-acts{display:flex;align-items:center;gap:.45rem;margin-top:.38rem}
.chk{width:21px;height:21px;border-radius:50%;border:2px solid var(--s5);background:transparent;cursor:pointer;transition:all .28s;display:flex;align-items:center;justify-content:center;font-size:.68rem;color:transparent;flex-shrink:0}
.chk:hover{border-color:var(--green)}
.chk.done{background:var(--green);border-color:var(--green);color:#fff}
.pom-start{background:transparent;border:none;color:var(--red);cursor:pointer;font-size:.63rem;display:flex;align-items:center;gap:2px;transition:color .2s}
.pom-start:hover{color:#ff6b6b}

/* Friday */
.fri-card{background:linear-gradient(135deg,rgba(229,9,20,.08),transparent);border:1px dashed var(--red);border-radius:8px;margin:.6rem;padding:.9rem;text-align:center;font-size:.78rem;color:var(--dim)}

/* Empty state */
.empty{grid-column:1/-1;text-align:center;padding:3rem;color:var(--muted)}
.empty-ico{font-size:3rem;opacity:.35;margin-bottom:.8rem}

/* ===========================
   ANALYTICS
=========================== */
.anl-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(270px,1fr));gap:.9rem}
.anl-card{background:var(--s1);border:1px solid var(--border);border-radius:var(--radius);padding:1.1rem}
.anl-t{font-size:.73rem;color:var(--muted);margin-bottom:.9rem;text-transform:uppercase;letter-spacing:.5px}
.big-n{font-size:2.6rem;font-weight:900;color:var(--red);line-height:1;margin-bottom:.25rem}
.big-l{font-size:.72rem;color:var(--muted)}
.bar-row{display:flex;align-items:center;gap:.7rem;margin-bottom:.55rem}
.bar-lbl{font-size:.72rem;color:var(--dim);min-width:75px;text-align:right;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.bar-trk{flex:1;height:7px;background:var(--s3);border-radius:4px;overflow:hidden}
.bar-fill{height:100%;background:linear-gradient(90deg,var(--red-dk),var(--red));border-radius:4px;transition:width .8s ease}
.bar-v{font-size:.68rem;color:var(--muted);min-width:22px}
.hm{display:flex;flex-wrap:wrap;gap:4px;margin-top:.45rem}
.hc{width:13px;height:13px;border-radius:2px;background:var(--s3);transition:transform .2s,background .3s;cursor:pointer}
.hc:hover{transform:scale(1.35)}
.hc.h1{background:rgba(229,9,20,.28)}.hc.h2{background:rgba(229,9,20,.5)}.hc.h3{background:rgba(229,9,20,.72)}.hc.h4{background:var(--red)}

/* ===========================
   FLASHCARDS
=========================== */
.fc-ctrl{display:flex;align-items:center;gap:.9rem;margin-bottom:1.3rem;flex-wrap:wrap}
.fc-sel{flex:1;min-width:140px}
.fc-prog{font-size:.82rem;color:var(--dim);white-space:nowrap}
.fc-area{display:flex;flex-direction:column;align-items:center;gap:1.3rem;padding:.9rem 0}
/* 3D flip */
.fc-scene{width:min(500px,100%);height:240px;perspective:1100px;cursor:pointer}
.fc-card{width:100%;height:100%;position:relative;transform-style:preserve-3d;transition:transform .58s cubic-bezier(.4,.2,.2,1)}
.fc-card.flipped{transform:rotateY(180deg)}
.fc-face{position:absolute;width:100%;height:100%;backface-visibility:hidden;border-radius:var(--radius);display:flex;flex-direction:column;align-items:center;justify-content:center;padding:1.4rem;text-align:center}
.fc-front{background:var(--s2);border:1px solid var(--border)}
.fc-back{background:linear-gradient(135deg,#180000,var(--s2));border:1px solid var(--red);transform:rotateY(180deg)}
.fc-hint{font-size:.68rem;color:var(--muted);margin-bottom:.45rem}
.fc-q{font-size:1.05rem;font-weight:700;color:var(--text)}
.fc-tag{font-size:.68rem;color:var(--red);margin-top:.7rem}
.fc-ans{font-size:.92rem;color:var(--text);line-height:1.6}
.fc-acts{display:flex;gap:.9rem}
.btn-fc{padding:.55rem 1.3rem;border:2px solid;border-radius:7px;cursor:pointer;font-size:.88rem;font-weight:700;transition:all .2s;background:transparent}
.btn-no{border-color:var(--red);color:var(--red)}.btn-no:hover{background:var(--red);color:#fff}
.btn-yes{border-color:var(--green);color:var(--green)}.btn-yes:hover{background:var(--green);color:#000}
.fc-nav{display:flex;align-items:center;gap:.9rem}
.btn-nav{width:34px;height:34px;border-radius:50%;background:var(--s3);border:1px solid var(--border);color:var(--text);cursor:pointer;font-size:.95rem;transition:all .2s;display:flex;align-items:center;justify-content:center}
.btn-nav:hover{background:var(--red);border-color:var(--red)}
.fc-ct{font-size:.82rem;color:var(--muted);min-width:55px;text-align:center}

/* ===========================
   POMODORO FAB
=========================== */
.pom-fab{position:fixed;bottom:1.8rem;left:1.8rem;z-index:300;display:flex;flex-direction:column;align-items:flex-start;gap:.5rem}
.pom-tog{width:52px;height:52px;border-radius:50%;background:linear-gradient(135deg,var(--red-dk),var(--red));border:none;color:#fff;font-size:1.4rem;cursor:pointer;transition:all .3s;box-shadow:0 4px 20px var(--red-glow);display:flex;align-items:center;justify-content:center}
.pom-tog:hover{transform:scale(1.12);box-shadow:0 6px 26px rgba(229,9,20,.5)}
.pom-panel{background:var(--s1);border:1px solid var(--red);border-radius:var(--radius);padding:1.1rem;min-width:205px;display:none;animation:slideUp .28s ease;box-shadow:0 8px 32px rgba(0,0,0,.55)}
.pom-panel.open{display:block}
.pom-ttl{font-size:.72rem;color:var(--red);font-weight:700;text-align:center;margin-bottom:.75rem}
.pom-ring-wrap{width:110px;height:110px;margin:0 auto .75rem;position:relative}
.pom-ring-wrap svg{transform:rotate(-90deg)}
.ring-bg{fill:none;stroke:var(--s4);stroke-width:5}
.ring-p{fill:none;stroke:var(--red);stroke-width:5;stroke-linecap:round;transition:stroke-dashoffset 1s linear}
.pom-time{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:1.15rem;font-weight:900;letter-spacing:1px;font-variant-numeric:tabular-nums;white-space:nowrap}
.pom-mode{text-align:center;font-size:.72rem;color:var(--muted);margin-bottom:.75rem}
.pom-btns{display:flex;gap:.45rem;justify-content:center}
.pom-btn{padding:.38rem .75rem;border-radius:6px;border:1px solid var(--border);background:var(--s3);color:var(--text);cursor:pointer;font-size:.78rem;transition:all .2s}
.pom-btn.primary{background:var(--red);border-color:var(--red);color:#fff}
.pom-btn:hover{background:var(--s5)}.pom-btn.primary:hover{background:var(--red-dk)}
.pom-sess{font-size:.68rem;color:var(--muted);text-align:center;margin-top:.45rem}

/* ===========================
   TOAST
=========================== */
.toast-ct{position:fixed;top:1rem;left:50%;transform:translateX(-50%);z-index:999;display:flex;flex-direction:column;gap:.45rem;pointer-events:none}
.toast{background:var(--s2);border:1px solid var(--border);border-radius:var(--radius);padding:.75rem 1.1rem;display:flex;align-items:center;gap:.75rem;min-width:240px;font-size:.82rem;box-shadow:0 8px 28px rgba(0,0,0,.55);animation:toastIn .35s ease;pointer-events:all}
.toast.ach{border-color:var(--gold);background:linear-gradient(135deg,rgba(255,193,7,.08),var(--s2))}
.toast.suc{border-color:var(--green)}.toast.inf{border-color:var(--red)}
.toast-ico{font-size:1.45rem}
.toast-t{font-weight:700;color:var(--text);font-size:.78rem}
.toast-m{font-size:.7rem;color:var(--muted)}

/* ===========================
   ANIMATIONS
=========================== */
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
@keyframes slideIn{from{opacity:0;transform:translateX(-8px)}to{opacity:1;transform:translateX(0)}}
@keyframes slideUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
@keyframes toastIn{from{opacity:0;transform:translateY(-18px)}to{opacity:1;transform:translateY(0)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.45}}
.pulsing{animation:pulse 1.4s infinite}

/* ===========================
   PRINT
=========================== */
@media print{
  header,.sidebar,.tabs,.pom-fab,.toast-ct,.quote-bar,.slot-acts{display:none!important}
  .container{display:block}
  .plan-grid{grid-template-columns:repeat(7,1fr)}
  body{background:#fff;color:#000}
  .day-col{border:1px solid #ccc;break-inside:avoid}
}
</style>
</head>
<body>

<!-- TOASTS --><div class="toast-ct" id="toastCt"></div>

<!-- HEADER -->
<header>
  <div style="display:flex;align-items:center;gap:.9rem">
    <div class="logo">BAC<b>FLIX</b></div>
    <div>
      <div style="font-size:.72rem;color:var(--muted)">Planner Pro 2.0</div>
      <div class="brand-meta">Ø¨ÙƒØ§Ù„ÙˆØ±ÙŠØ§ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± â€” Ù…Ø±Ø§Ø¬Ø¹Ø© Ø°ÙƒÙŠØ©</div>
    </div>
  </div>
  <div class="hdr-right">
    <div class="streak-pill">ğŸ”¥ <span id="strVal">0</span> ÙŠÙˆÙ…</div>
    <div class="xp-wrap">
      <div class="xp-label">Niv.<span id="lvlN" style="color:var(--red);font-weight:700">1</span> â€” <span id="xpTxt">0 XP</span></div>
      <div class="xp-bar"><div class="xp-fill" id="xpFill" style="width:0%"></div></div>
    </div>
  </div>
</header>

<!-- QUOTE BAR --><div class="quote-bar"><em>"</em><span id="quoteText">Ø§Ù„Ù†Ø¬Ø§Ø­ Ù„ÙŠØ³ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø·Ø±ÙŠÙ‚ØŒ Ø¨Ù„ Ù‡Ùˆ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø±Ø©</span><em>"</em></div>

<!-- CONTAINER --><div class="container">

  <!-- ===== SIDEBAR ===== -->
  <aside class="sidebar">

    <div class="card">
      <div class="card-t">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø·Ø©</div>
      <select id="branchSel" onchange="loadBranch()">
        <option value="math">Ø´Ø¹Ø¨Ø© Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option>
        <option value="science">Ø¹Ù„ÙˆÙ… ØªØ¬Ø±ÙŠØ¨ÙŠØ©</option>
        <option value="tech">ØªÙ‚Ù†ÙŠ Ø±ÙŠØ§Ø¶ÙŠ</option>
        <option value="mgt">ØªØ³ÙŠÙŠØ± ÙˆØ§Ù‚ØªØµØ§Ø¯</option>
        <option value="lit">Ø¢Ø¯Ø§Ø¨ ÙˆÙÙ„Ø³ÙØ©</option>
      </select>
      <div class="card-t" style="margin-top:.8rem">ğŸ“Š Ù…Ø³ØªÙˆØ§Ùƒ ÙÙŠ ÙƒÙ„ Ù…Ø§Ø¯Ø©</div>
      <div class="subj-list" id="subjList"></div>
      <button class="btn-gen" onclick="generatePlan()">âš¡ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø°ÙƒÙŠØ©</button>
    </div>

    <div class="card">
      <div class="card-t">ğŸ“ˆ ØªÙ‚Ø¯Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</div>
      <div id="progArea"><p style="color:var(--muted);font-size:.78rem;text-align:center">ÙˆÙ„Ù‘Ø¯ Ø®Ø·ØªÙƒ Ø£ÙˆÙ„Ø§Ù‹</p></div>
    </div>

    <div class="card">
      <div class="card-t">ğŸ† Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</div>
      <div class="badges-wrap" id="badgesWrap">
        <div class="badge" id="b-first">ğŸ¯ Ø£ÙˆÙ„ Ø­ØµØ©</div>
        <div class="badge" id="b-s3">ğŸ”¥ 3 Ø£ÙŠØ§Ù…</div>
        <div class="badge" id="b-s7">âš¡ Ø£Ø³Ø¨ÙˆØ¹</div>
        <div class="badge" id="b-half">ğŸŒŸ Ø§Ù„Ù†ØµÙ</div>
        <div class="badge" id="b-full">ğŸ‘‘ Ø§ÙƒØªÙ…Ø§Ù„</div>
        <div class="badge" id="b-all">ğŸ“š ÙƒÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯</div>
        <div class="badge" id="b-pom3">â± 3 Ø¨ÙˆÙ…ÙˆØ¯ÙˆØ±Ùˆ</div>
        <div class="badge" id="b-fc10">ğŸƒ 10 Ø¨Ø·Ø§Ù‚Ø§Øª</div>
      </div>
    </div>

    <div class="card">
      <div class="rules-box">
        <div class="rules-t">ğŸ’¡ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©</div>
        <ul style="padding-right:14px;margin-top:.3rem">
          <li>Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¶Ø¹ÙŠÙØ© â†’ ÙØªØ±Ø§Øª Ø§Ù„ØµØ¨Ø§Ø­ Ø¯Ø§Ø¦Ù…Ø§Ù‹</li>
          <li>50% ÙÙ‡Ù… Â· 30% ØªÙ…Ø§Ø±ÙŠÙ† Â· 20% Ù…Ø±Ø§Ø¬Ø¹Ø©</li>
          <li>Ù„Ø§ ØªÙƒØ±Ø± Ù†ÙØ³ Ø§Ù„Ù…Ø§Ø¯Ø© ÙŠÙˆÙ…ÙŠÙ† Ù…ØªØªØ§Ù„ÙŠÙŠÙ†</li>
          <li>Ø§Ø³ØªØ®Ø¯Ù… Ø¨ÙˆÙ…ÙˆØ¯ÙˆØ±Ùˆ: 25 Ø¯Ù‚ÙŠÙ‚Ø© ØªØ±ÙƒÙŠØ² + 5 Ø§Ø³ØªØ±Ø§Ø­Ø©</li>
          <li>Ù‚ÙŠÙ‘Ù… Ø«Ù‚ØªÙƒ Ø¨Ø§Ù„Ù†Ø¬ÙˆÙ… â­ Ø¨Ø¹Ø¯ ÙƒÙ„ Ø­ØµØ©</li>
          <li>Ø§Ù„Ø¬Ù…Ø¹Ø© ÙŠÙˆÙ… Ù…Ø±Ø§Ø¬Ø¹Ø© Ø´Ø§Ù…Ù„Ø© ÙˆÙØ±ÙˆØ¶</li>
        </ul>
      </div>
    </div>

  </aside>

  <!-- ===== MAIN ===== -->
  <main class="main">

    <!-- TABS -->
    <div class="tabs">
      <button class="tab-btn active" onclick="switchTab('plan',this)">ğŸ“… Ø§Ù„Ø®Ø·Ø©</button>
      <button class="tab-btn" onclick="switchTab('analytics',this)">ğŸ“Š Ø§Ù„ØªØ­Ù„ÙŠÙ„</button>
      <button class="tab-btn" onclick="switchTab('flashcards',this)">ğŸƒ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</button>
    </div>

    <!-- PLAN TAB -->
    <div class="tab-pane active" id="tab-plan">
      <div class="plan-hdr">
        <div style="color:var(--dim);font-size:.9rem">Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ©</div>
        <div class="hdr-acts">
          <button class="btn-sm" onclick="resetProg()">â†©ï¸ ØªØµÙÙŠØ±</button>
          <button class="btn-sm" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
        </div>
      </div>
      <div class="plan-grid" id="planGrid">
        <div class="empty"><div class="empty-ico">ğŸ“</div><div>Ø§Ø®ØªØ± Ø´Ø¹Ø¨ØªÙƒ Â· Ø­Ø¯Ø¯ Ù…Ø³ØªÙˆØ§Ùƒ Â· Ø§Ø¶ØºØ· "ØªÙˆÙ„ÙŠØ¯"</div></div>
      </div>
    </div>

    <!-- ANALYTICS TAB -->
    <div class="tab-pane" id="tab-analytics">
      <div class="anl-grid" id="anlGrid">
        <div class="empty" style="grid-column:1/-1"><div class="empty-ico">ğŸ“Š</div><div>ÙˆÙ„Ù‘Ø¯ Ø®Ø·ØªÙƒ Ø£ÙˆÙ„Ø§Ù‹</div></div>
      </div>
    </div>

    <!-- FLASHCARDS TAB -->
    <div class="tab-pane" id="tab-flashcards">
      <div class="fc-ctrl">
        <select id="fcSel" class="fc-sel" onchange="loadFC()">
          <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©...</option>
        </select>
        <div class="fc-prog" id="fcProg"></div>
        <button class="btn-sm" onclick="shuffleFC()">ğŸ”€ Ø®Ù„Ø·</button>
        <button class="btn-sm" onclick="resetFC()">â†©ï¸ Ø¥Ø¹Ø§Ø¯Ø©</button>
      </div>
      <div class="fc-area" id="fcArea">
        <div class="empty"><div class="empty-ico">ğŸƒ</div><div>Ø§Ø®ØªØ± Ù…Ø§Ø¯Ø© Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¨Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</div></div>
      </div>
    </div>

  </main>
</div>

<!-- POMODORO FAB --><div class="pom-fab">
  <div class="pom-panel" id="pomPanel">
    <div class="pom-ttl">â± Ù…Ø¤Ù‚Øª Ø¨ÙˆÙ…ÙˆØ¯ÙˆØ±Ùˆ</div>
    <div class="pom-ring-wrap">
      <svg width="110" height="110" viewBox="0 0 110 110">
        <circle class="ring-bg" cx="55" cy="55" r="48"/>
        <circle class="ring-p" id="pomRing" cx="55" cy="55" r="48"
          stroke-dasharray="301.6" stroke-dashoffset="0"/>
      </svg>
      <div class="pom-time" id="pomTime">25:00</div>
    </div>
    <div class="pom-mode" id="pomMode">ğŸ§  ÙˆÙ‚Øª Ø§Ù„ØªØ±ÙƒÙŠØ²</div>
    <div class="pom-btns">
      <button class="pom-btn primary" id="pomSBtn" onclick="pomToggle()">â–¶ Ø§Ø¨Ø¯Ø£</button>
      <button class="pom-btn" onclick="pomReset()">âŸ³ Ø¥Ø¹Ø§Ø¯Ø©</button>
    </div>
    <div class="pom-sess" id="pomSess">Ø§Ù„Ø¬Ù„Ø³Ø© 1 Ù…Ù† 4</div>
  </div>
  <button class="pom-tog" onclick="togglePom()" title="Ù…Ø¤Ù‚Øª Ø¨ÙˆÙ…ÙˆØ¯ÙˆØ±Ùˆ">â±</button>
</div>

<script>
// =================================================================
// BRANCH DATA
// =================================================================
const BRANCHES = {
  math:{name:"Ø±ÙŠØ§Ø¶ÙŠØ§Øª",subjects:[
    {name:"Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª",coeff:7},{name:"Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ©",coeff:6},
    {name:"Ø¹Ù„ÙˆÙ… Ø§Ù„Ø·Ø¨ÙŠØ¹Ø© Ùˆ Ø§Ù„Ø­ÙŠØ§Ø©",coeff:2},{name:"Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",coeff:3},
    {name:"Ø§Ù„Ù„ØºØ© Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©",coeff:2},{name:"Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©",coeff:2},
    {name:"Ø§Ù„ÙÙ„Ø³ÙØ©",coeff:2},{name:"Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©",coeff:2}
  ]},
  science:{name:"Ø¹Ù„ÙˆÙ… ØªØ¬Ø±ÙŠØ¨ÙŠØ©",subjects:[
    {name:"Ø¹Ù„ÙˆÙ… Ø§Ù„Ø·Ø¨ÙŠØ¹Ø© Ùˆ Ø§Ù„Ø­ÙŠØ§Ø©",coeff:6},{name:"Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ©",coeff:5},
    {name:"Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª",coeff:5},{name:"Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",coeff:3},
    {name:"Ø§Ù„Ù„ØºØ© Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©",coeff:2},{name:"Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©",coeff:2},
    {name:"Ø§Ù„ÙÙ„Ø³ÙØ©",coeff:2}
  ]},
  tech:{name:"ØªÙ‚Ù†ÙŠ Ø±ÙŠØ§Ø¶ÙŠ",subjects:[
    {name:"Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§",coeff:7},{name:"Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª",coeff:6},
    {name:"Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ©",coeff:6},{name:"Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",coeff:3},
    {name:"Ø§Ù„Ù„ØºØ© Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©",coeff:2},{name:"Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©",coeff:2},
    {name:"Ø§Ù„ÙÙ„Ø³ÙØ©",coeff:2}
  ]},
  mgt:{name:"ØªØ³ÙŠÙŠØ± ÙˆØ§Ù‚ØªØµØ§Ø¯",subjects:[
    {name:"Ø§Ù„ØªØ³ÙŠÙŠØ± Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ Ùˆ Ø§Ù„Ù…Ø§Ù„ÙŠ",coeff:6},{name:"Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ Ùˆ Ø§Ù„Ù…Ù†Ø§Ø¬Ù…Ù†Øª",coeff:5},
    {name:"Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª",coeff:5},{name:"Ø§Ù„ØªØ§Ø±ÙŠØ® Ùˆ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§",coeff:4},
    {name:"Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",coeff:3},{name:"Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†",coeff:2}
  ]},
  lit:{name:"Ø¢Ø¯Ø§Ø¨ ÙˆÙÙ„Ø³ÙØ©",subjects:[
    {name:"Ø§Ù„ÙÙ„Ø³ÙØ©",coeff:6},{name:"Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",coeff:5},
    {name:"Ø§Ù„ØªØ§Ø±ÙŠØ® Ùˆ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§",coeff:4},{name:"Ø§Ù„Ù„ØºØ© Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©",coeff:3},
    {name:"Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©",coeff:3},{name:"Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª",coeff:2}
  ]}
};

// =================================================================
// FLASHCARD DATABASE
// =================================================================
const FCDB = {
  "Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª":[
    {q:"Ù…Ø´ØªÙ‚Ø© sin(x)ØŸ",a:"cos(x)"},
    {q:"Ù…Ø´ØªÙ‚Ø© ln(x)ØŸ",a:"1/x"},
    {q:"Ù…Ø´ØªÙ‚Ø© eË£ØŸ",a:"eË£ (Ù„Ø§ ØªØªØºÙŠØ±)"},
    {q:"ØµÙŠØºØ© Ø§Ù„ØªÙƒØ§Ù…Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©ØŸ",a:"âˆ«f'(x)dx = f(x) + C"},
    {q:"Ù†Ù‡Ø§ÙŠØ© sin(x)/x Ø¹Ù†Ø¯Ù…Ø§ xâ†’0ØŸ",a:"= 1"},
    {q:"Ø´Ø±Ø· Ø§Ø´ØªÙ‚Ø§Ù‚ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¹Ù†Ø¯ Ù†Ù‚Ø·Ø©ØŸ",a:"ÙŠØ¬Ø¨ Ø£Ù† ØªØªØ³Ø§ÙˆÙ‰ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙŠÙ…Ù†Ù‰ ÙˆØ§Ù„ÙŠØ³Ø±Ù‰"},
    {q:"Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ù…Ù…Ø§Ø³ Ù„Ù„Ù…Ù†Ø­Ù†Ù‰ Ø¹Ù†Ø¯ xâ‚€ØŸ",a:"y = f'(xâ‚€)(xâˆ’xâ‚€) + f(xâ‚€)"},
    {q:"Ù…ØªÙ‰ ØªÙƒÙˆÙ† Ø§Ù„Ø¯Ø§Ù„Ø© Ù…ØªØµØ§Ø¹Ø¯Ø©ØŸ",a:"Ø¹Ù†Ø¯Ù…Ø§ f'(x) > 0 Ø¹Ù„Ù‰ Ø§Ù„ÙØªØ±Ø©"}
  ],
  "Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ©":[
    {q:"Ù‚Ø§Ù†ÙˆÙ† Ù†ÙŠÙˆØªÙ† Ø§Ù„Ø«Ø§Ù†ÙŠØŸ",a:"Î£Fâƒ— = mÂ·aâƒ—"},
    {q:"Ù‚Ø§Ù†ÙˆÙ† Ø£ÙˆÙ…ØŸ",a:"U = RÂ·I"},
    {q:"Ø·Ø§Ù‚Ø© Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¬Ø§Ø°Ø¨ÙŠØ©ØŸ",a:"Ep = mÂ·gÂ·h"},
    {q:"Ø³Ø±Ø¹Ø© Ø§Ù„Ø¶ÙˆØ¡ ÙÙŠ Ø§Ù„ÙØ±Ø§ØºØŸ",a:"c = 3Ã—10â¸ m/s"},
    {q:"Ù‚Ø§Ù†ÙˆÙ† Ø­ÙØ¸ Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ©ØŸ",a:"Em = Ec + Ep = Ø«Ø§Ø¨Øª (Ø¨Ø¯ÙˆÙ† Ø§Ø­ØªÙƒØ§Ùƒ)"},
    {q:"Ø²Ù…Ù† Ù†ØµÙ Ø¹Ù…Ø± Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø¥Ø´Ø¹Ø§Ø¹ÙŠØŸ",a:"tâ‚/â‚‚ = ln2 / Î»"},
    {q:"Ù‚Ø§Ù†ÙˆÙ† ÙƒÙˆÙ„ÙˆÙ… Ù„Ù„Ø´Ø­Ù†Ø§ØªØŸ",a:"F = kÂ·qâ‚Â·qâ‚‚/rÂ²"}
  ],
  "Ø¹Ù„ÙˆÙ… Ø§Ù„Ø·Ø¨ÙŠØ¹Ø© Ùˆ Ø§Ù„Ø­ÙŠØ§Ø©":[
    {q:"ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù…ÙŠØªÙˆÙƒÙˆÙ†Ø¯Ø±ÙŠØ§ØŸ",a:"Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ø·Ø§Ù‚Ø© (ATP) â€” Ù…Ø­Ø·Ø© Ø§Ù„Ø®Ù„ÙŠØ©"},
    {q:"Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ù€ DNAØŸ",a:"Ø¬Ø²ÙŠØ¡ ÙŠØ­Ù…Ù„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙˆØ±Ø§Ø«ÙŠØ© (Ù‚ÙˆØ§Ø¹Ø¯ Ø£Ø²ÙˆØªÙŠØ© + Ø³ÙƒØ± + ÙÙˆØ³ÙØ§Øª)"},
    {q:"Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ø®Ù„ÙŠØ© Ø§Ù„Ù†Ø¨Ø§ØªÙŠØ© ÙˆØ§Ù„Ø­ÙŠÙˆØ§Ù†ÙŠØ©ØŸ",a:"Ø§Ù„Ù†Ø¨Ø§ØªÙŠØ©: Ø¬Ø¯Ø§Ø± Ø®Ù„ÙˆÙŠ + Ø¨Ù„Ø§Ø³ØªÙŠØ¯Ø§Øª Ø®Ø¶Ø±Ø§Ø¡ + ÙØ¬ÙˆØ© Ø¹ØµØ§Ø±ÙŠØ©"},
    {q:"ØªØ¹Ø±ÙŠÙ Ø§Ù„ØªÙ†ÙØ³ Ø§Ù„Ø®Ù„ÙˆÙŠØŸ",a:"ØªØ­Ù„Ù„ Ø§Ù„ØºÙ„ÙˆÙƒÙˆØ² Ø¨ÙˆØ¬ÙˆØ¯ Oâ‚‚ â†’ ATP + COâ‚‚ + Hâ‚‚O"},
    {q:"Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø§Ù†Ø¹ÙƒØ§Ø³ Ø§Ù„Ù…Ù†Ø¹ÙƒØ³ØŸ",a:"Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù„Ø§ Ø¥Ø±Ø§Ø¯ÙŠØ© ØªÙ…Ø± Ø¹Ø¨Ø± Ø§Ù„Ù†Ø®Ø§Ø¹ Ø§Ù„Ø´ÙˆÙƒÙŠ"},
    {q:"Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ù‡Ø±Ù…ÙˆÙ†ØŸ",a:"Ù…Ø§Ø¯Ø© ÙƒÙŠÙ…ÙŠØ§Ø¦ÙŠØ© ØªÙØ±Ø²Ù‡Ø§ Ø§Ù„ØºØ¯Ø¯ ÙˆØªÙ†ØªÙ‚Ù„ Ø¹Ø¨Ø± Ø§Ù„Ø¯Ù… Ù„Ù„ØªÙ†Ø³ÙŠÙ‚"}
  ],
  "Ø§Ù„ÙÙ„Ø³ÙØ©":[
    {q:"Ù…Ù† Ù‚Ø§Ù„: Ø§Ù„Ø¥Ù†Ø³Ø§Ù† Ø­ÙŠÙˆØ§Ù† Ø¹Ø§Ù‚Ù„ØŸ",a:"Ø£Ø±Ø³Ø·Ùˆ"},
    {q:"Ù…Ø¨Ø¯Ø£ Ø§Ù„Ø´Ùƒ Ø§Ù„Ø¯ÙŠÙƒØ§Ø±ØªÙŠØŸ",a:"Ø£Ø´Ùƒ ÙÙŠ ÙƒÙ„ Ø´ÙŠØ¡ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ ÙŠÙ‚ÙŠÙ† â†’ Ø£Ù†Ø§ Ø£ÙÙƒØ± Ø¥Ø°Ù† Ø£Ù†Ø§ Ù…ÙˆØ¬ÙˆØ¯"},
    {q:"Ø§Ù„ÙÙ„Ø³ÙØ© Ø§Ù„Ø¨Ø±Ø§ØºÙ…Ø§ØªÙŠØ©ØŸ",a:"Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© Ù‡ÙŠ Ù…Ø§ ÙŠÙ†Ø¬Ø­ ÙˆÙŠÙÙŠØ¯ Ø¹Ù…Ù„ÙŠØ§Ù‹ (ÙˆÙ„ÙŠØ§Ù… Ø¬ÙŠÙ…Ø³ØŒ Ø¬ÙˆÙ† Ø¯ÙŠÙˆÙŠ)"},
    {q:"Ø§Ù„ÙˆØ¬ÙˆØ¯ÙŠØ© Ø¹Ù†Ø¯ Ø³Ø§Ø±ØªØ±ØŸ",a:"Ø§Ù„ÙˆØ¬ÙˆØ¯ ÙŠØ³Ø¨Ù‚ Ø§Ù„Ù…Ø§Ù‡ÙŠØ© â€” Ø§Ù„Ø¥Ù†Ø³Ø§Ù† ÙŠØµÙ†Ø¹ Ø°Ø§ØªÙ‡ Ø¨Ø­Ø±ÙŠØ© Ù…Ø·Ù„Ù‚Ø©"},
    {q:"Ø§Ù„ÙÙŠÙ„Ø³ÙˆÙ Ø§Ù„Ø°ÙŠ Ù‚Ø³Ù‘Ù… Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø¥Ù„Ù‰ Ø¹Ù‚Ù„ÙŠØ© ÙˆØ­Ø³ÙŠØ©ØŸ",a:"ÙƒØ§Ù†Ø· (ÙÙŠ Ù†Ù‚Ø¯ Ø§Ù„Ø¹Ù‚Ù„ Ø§Ù„Ø®Ø§Ù„Øµ)"},
    {q:"Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø¯ÙŠØ§Ù„ÙƒØªÙŠÙƒ Ø¹Ù†Ø¯ Ù‡ÙŠØºÙ„ØŸ",a:"Ù…Ù†Ù‡Ø¬ Ù‚Ø§Ø¦Ù… Ø¹Ù„Ù‰: Ø§Ù„Ø£Ø·Ø±ÙˆØ­Ø© + Ø§Ù„Ù†Ù‚ÙŠØ¶Ø© â†’ Ø§Ù„ØªØ±ÙƒÙŠØ¨"}
  ],
  "Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©":[
    {q:"Ø£Ø±ÙƒØ§Ù† Ø§Ù„Ø¬Ù…Ù„Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ©ØŸ",a:"ÙØ¹Ù„ + ÙØ§Ø¹Ù„ (+ Ù…ÙØ¹ÙˆÙ„ Ø¨Ù‡ Ø¥Ù† ÙƒØ§Ù† Ø§Ù„ÙØ¹Ù„ Ù…ØªØ¹Ø¯ÙŠØ§Ù‹)"},
    {q:"Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø¨ØªØ¯Ø£ ÙˆØ§Ù„Ø®Ø¨Ø±ØŸ",a:"Ø§Ù„Ù…Ø¨ØªØ¯Ø£: Ù…Ø³Ù†Ø¯ Ø¥Ù„ÙŠÙ‡ Ù…Ø±ÙÙˆØ¹. Ø§Ù„Ø®Ø¨Ø±: Ù…Ø³Ù†Ø¯ ÙŠÙƒÙ…Ù„ Ø§Ù„Ù…Ø¹Ù†Ù‰"},
    {q:"ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø±Ø©ØŸ",a:"ØªØ´Ø¨ÙŠÙ‡ Ø¨Ù„ÙŠØº Ø­ÙØ°Ù Ø£Ø­Ø¯ Ø·Ø±ÙÙŠÙ‡ Ù…Ø¹ Ù‚Ø±ÙŠÙ†Ø©"},
    {q:"Ù…Ø§ Ù‡Ùˆ Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„ØªÙˆÙƒÙŠØ¯ØŸ",a:"Ø¥Ù†ØŒ Ø£Ù†ØŒ Ø§Ù„Ù„Ø§Ù… Ø§Ù„Ù…Ø²Ø­Ù„Ù‚Ø©ØŒ Ù‚Ø¯ØŒ Ù†ÙˆÙ†Ø§ Ø§Ù„ØªÙˆÙƒÙŠØ¯..."},
    {q:"Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ÙƒÙ„Ø§Ù… ÙÙŠ Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©ØŸ",a:"Ø§Ø³Ù…ØŒ ÙØ¹Ù„ØŒ Ø­Ø±Ù"}
  ],
  "Ø§Ù„ØªØ§Ø±ÙŠØ® Ùˆ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§":[
    {q:"Ù…ØªÙ‰ Ø§Ù†Ø¯Ù„Ø¹Øª Ø§Ù„Ø«ÙˆØ±Ø© Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ©ØŸ",a:"Ø£ÙˆÙ„ Ù†ÙˆÙÙ…Ø¨Ø± 1954"},
    {q:"Ù…Ø§ Ù‡ÙŠ Ø§ØªÙØ§Ù‚ÙŠØ© Ø¥ÙŠÙÙŠØ§Ù†ØŸ",a:"Ø§ØªÙØ§Ù‚ÙŠØ© ÙˆÙ‚Ù Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ù†Ø§Ø± Ø¨ÙŠÙ† Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± ÙˆÙØ±Ù†Ø³Ø§ (19 Ù…Ø§Ø±Ø³ 1962)"},
    {q:"Ø£Ø³Ø¨Ø§Ø¨ Ø§Ù„Ø­Ø±Ø¨ Ø§Ù„Ø¨Ø§Ø±Ø¯Ø©ØŸ",a:"Ø§Ù„ØµØ±Ø§Ø¹ Ø§Ù„Ø£ÙŠØ¯ÙŠÙˆÙ„ÙˆØ¬ÙŠ (Ø±Ø£Ø³Ù…Ø§Ù„ÙŠØ© vs Ø§Ø´ØªØ±Ø§ÙƒÙŠØ©) Ø¨ÙŠÙ† Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠØªÙŠÙ† ÙˆØ§Ù„Ø³ÙˆÙÙŠÙŠØª"},
    {q:"Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø¹ÙˆÙ„Ù…Ø©ØŸ",a:"ØªØ¯ÙˆÙŠÙ„ Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ ÙˆØ§Ù„Ø«Ù‚Ø§ÙØ© ÙˆØ§Ù„Ø§ØªØµØ§Ù„Ø§Øª Ø¹Ø¨Ø± Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø¯ÙˆØ¯ ÙˆØ§Ù„ØªÙƒØ§Ù…Ù„ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ"},
    {q:"Ø£Ù‡Ù…ÙŠØ© Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØŸ",a:"ØªÙ‚Ø§Ø·Ø¹ Ø·Ø±Ù‚ Ø£ÙˆØ±ÙˆØ¨Ø§ ÙˆØ£ÙØ±ÙŠÙ‚ÙŠØ§ØŒ ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø­Ø±ÙŠØ© Ù…ØªÙˆØ³Ø·ÙŠØ©ØŒ Ø¨ÙˆØ§Ø¨Ø© ØµØ­Ø±Ø§Ø¡ ÙƒØ¨Ø±Ù‰"}
  ],
  "Ø§Ù„Ù„ØºØ© Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©":[
    {q:"Conjuguez 'avoir' au prÃ©sent (nous)?",a:"nous avons"},
    {q:"La nÃ©gation simple en franÃ§ais?",a:"ne ... pas (ex: Je ne sais pas)"},
    {q:"Imparfait vs PassÃ© composÃ©?",a:"Imparfait = habitude/description. PC = action prÃ©cise/terminÃ©e"},
    {q:"Le subjonctif s'emploie aprÃ¨s...?",a:"il faut que, bien que, pour que, vouloir que..."},
    {q:"Les connecteurs logiques de cause?",a:"parce que, car, puisque, Ã©tant donnÃ© que"}
  ],
  "Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©":[
    {q:"Present Perfect usage?",a:"Past actions with present result: I have finished my homework."},
    {q:"Will vs Going to?",a:"Will = spontaneous decisions. Going to = planned intentions."},
    {q:"Conditional type 2 structure?",a:"If + past simple, would + infinitive (If I were you, I would study)"},
    {q:"Passive voice formula?",a:"Subject + be (conjugated) + past participle"},
    {q:"Articles: a/an/the?",a:"a/an = indefinite (first mention). the = definite (known/specific)"}
  ],
  "Ø§Ù„ØªØ³ÙŠÙŠØ± Ø§Ù„Ù…Ø­Ø§Ø³Ø¨ÙŠ Ùˆ Ø§Ù„Ù…Ø§Ù„ÙŠ":[
    {q:"Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©ØŸ",a:"Ø§Ù„Ø£ØµÙˆÙ„ = Ø§Ù„Ø®ØµÙˆÙ… + Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ©"},
    {q:"Ù…Ø§ Ù‡ÙŠ Ù†Ù‚Ø·Ø© Ø§Ù„ØªØ¹Ø§Ø¯Ù„ØŸ",a:"Ø§Ù„Ù†Ù‚Ø·Ø© Ø§Ù„ØªÙŠ ØªØªØ³Ø§ÙˆÙ‰ Ø¹Ù†Ø¯Ù‡Ø§ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ù…Ø¹ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ"},
    {q:"Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„Ø«Ø§Ø¨ØªØ© ÙˆØ§Ù„Ù…ØªØºÙŠØ±Ø©ØŸ",a:"Ø§Ù„Ø«Ø§Ø¨ØªØ©: Ù„Ø§ ØªØªØºÙŠØ± Ø¨Ø§Ù„Ø¥Ù†ØªØ§Ø¬. Ø§Ù„Ù…ØªØºÙŠØ±Ø©: ØªØ±ØªÙØ¹ Ø¨Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø¥Ù†ØªØ§Ø¬"},
    {q:"Ù…Ø§ Ù‡Ùˆ Ø§Ù„ØªØ¯ÙÙ‚ Ø§Ù„Ù†Ù‚Ø¯ÙŠØŸ",a:"Ø­Ø±ÙƒØ© Ø§Ù„Ø£Ù…ÙˆØ§Ù„ Ø§Ù„Ø¯Ø§Ø®Ù„Ø© ÙˆØ§Ù„Ø®Ø§Ø±Ø¬Ø© Ù…Ù† Ø§Ù„Ù…Ø¤Ø³Ø³Ø© Ø®Ù„Ø§Ù„ ÙØªØ±Ø©"}
  ],
  "Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ Ùˆ Ø§Ù„Ù…Ù†Ø§Ø¬Ù…Ù†Øª":[
    {q:"Ù…Ø§ Ù‡Ùˆ Ø§Ù„ØªØ¶Ø®Ù…ØŸ",a:"Ø§Ø±ØªÙØ§Ø¹ Ù…Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¹Ø§Ù… Ù„Ù„Ø£Ø³Ø¹Ø§Ø± â†’ Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ø´Ø±Ø§Ø¦ÙŠØ©"},
    {q:"Ø£Ù†ÙˆØ§Ø¹ Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ø³ÙˆÙ‚ØŸ",a:"Ù…Ù†Ø§ÙØ³Ø© ØªØ§Ù…Ø©ØŒ Ø§Ø­ØªÙƒØ§Ø±ØŒ Ø§Ø­ØªÙƒØ§Ø± Ø§Ù„Ù‚Ù„Ø©ØŒ Ù…Ù†Ø§ÙØ³Ø© Ø§Ø­ØªÙƒØ§Ø±ÙŠØ©"},
    {q:"Ù…ÙÙ‡ÙˆÙ… Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© ÙÙŠ Ø§Ù„ØªØ³ÙŠÙŠØ±ØŸ",a:"Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ£Ø«ÙŠØ± ÙÙŠ Ø§Ù„ÙØ±ÙŠÙ‚ Ù„ØªØ­Ù‚ÙŠÙ‚ Ø£Ù‡Ø¯Ø§Ù Ø§Ù„Ù…Ø¤Ø³Ø³Ø©"},
    {q:"Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ù†Ø§ØªØ¬ Ø§Ù„Ù…Ø­Ù„ÙŠ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ GDPØŸ",a:"Ù…Ø¬Ù…ÙˆØ¹ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³Ù„Ø¹ ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¨Ù„Ø¯ Ø®Ù„Ø§Ù„ Ø³Ù†Ø©"}
  ]
};

const QUOTES = [
  "Ø§Ù„Ù†Ø¬Ø§Ø­ Ù„ÙŠØ³ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø·Ø±ÙŠÙ‚ØŒ Ø¨Ù„ Ù‡Ùˆ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø±Ø©.",
  "Ø§Ù„Ø¹Ù„Ù… Ù†ÙˆØ± ÙˆØ§Ù„Ø¬Ù‡Ù„ Ø¸Ù„Ø§Ù… â€” Ø§Ø¨Ø¯Ø£ Ø¨Ø®Ø·ÙˆØ© ÙˆØ§Ø­Ø¯Ø©.",
  "Le succÃ¨s est la somme de petits efforts rÃ©pÃ©tÃ©s.",
  "Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø· ÙŠÙØ¹Ù„ Ù…Ø§ Ù„Ø§ ØªØ³ØªØ·ÙŠØ¹ Ø§Ù„Ø¥Ø±Ø§Ø¯Ø© ÙˆØ­Ø¯Ù‡Ø§ ÙØ¹Ù„Ù‡.",
  "ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„ÙŠÙˆÙ… = Ø³Ø§Ø¹Ø© Ø±Ø§Ø­Ø© ÙÙŠ ÙŠÙˆÙ… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†.",
  "Work hard in silence, let success make the noise.",
  "Ø§Ù„Ø¯Ø±Ø§Ø³Ø© Ø§Ù„Ø°ÙƒÙŠØ© Ø£ÙØ¶Ù„ Ù…Ù† Ø§Ù„Ø¯Ø±Ø§Ø³Ø© Ø§Ù„Ø·ÙˆÙŠÙ„Ø©.",
  "Ø£ØµØ¹Ø¨ Ù„Ø­Ø¸Ø© Ù‡ÙŠ Ù„Ø­Ø¸Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© â€” Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†.",
  "ÙƒÙ„ Ù…Ø§Ø¯Ø© Ø¶Ø¹ÙŠÙØ© Ù‡ÙŠ ÙØ±ØµØ© Ù„ÙƒØ³Ø¨ Ù†Ù‚Ø§Ø· Ø¥Ø¶Ø§ÙÙŠØ©.",
  "ØªØ°ÙƒØ±: Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ù„Ø§ ÙŠÙ‚ÙŠØ³ Ø°ÙƒØ§Ø¡ÙƒØŒ Ø¨Ù„ ÙŠÙ‚ÙŠØ³ Ø§Ø³ØªØ¹Ø¯Ø§Ø¯Ùƒ.",
  "Ne remets pas Ã  demain ce que tu peux rÃ©viser aujourd'hui.",
  "ÙÙƒÙ‘Ø± ÙÙŠ Ù‡Ø¯ÙÙƒ ÙƒÙ„ ØµØ¨Ø§Ø­ â€” Ø«Ù… Ø§Ø¹Ù…Ù„ Ù…Ù† Ø£Ø¬Ù„Ù‡."
];

// =================================================================
// STATE
// =================================================================
let curSubjects = [];
let tasks = {};        // {id: {done, conf, subj}}
let xp = 0, level = 1, streak = 0, lastDate = null;
let curFC = [], fcIdx = 0, fcKnown = 0, fcTotal = 0;
let pomSec = 25*60, pomAct = false, pomBreak = false, pomSess = 1, pomCnt = 0;
let pomTimer = null;
let planDone = false;
let badges = new Set();
const XPL = 100;
const CIRC = 301.6; // 2Ï€*48

// =================================================================
// INIT
// =================================================================
function init(){
  loadSt();
  loadBranch();
  rotateQuote();
  setInterval(rotateQuote, 28000);
  updateXPUI();
  updateStrUI();
}

// =================================================================
// PERSISTENCE
// =================================================================
function saveSt(){
  try{
    localStorage.setItem('bf2_tasks', JSON.stringify(tasks));
    localStorage.setItem('bf2_xp', xp);
    localStorage.setItem('bf2_level', level);
    localStorage.setItem('bf2_streak', streak);
    localStorage.setItem('bf2_date', lastDate);
    localStorage.setItem('bf2_badges', JSON.stringify([...badges]));
    localStorage.setItem('bf2_pomCnt', pomCnt);
  }catch(e){}
}

function loadSt(){
  try{
    const t = localStorage.getItem('bf2_tasks');
    if(t) tasks = JSON.parse(t);
    xp    = +localStorage.getItem('bf2_xp')     || 0;
    level = +localStorage.getItem('bf2_level')   || 1;
    streak= +localStorage.getItem('bf2_streak')  || 0;
    lastDate = localStorage.getItem('bf2_date');
    pomCnt= +localStorage.getItem('bf2_pomCnt')  || 0;
    const b = localStorage.getItem('bf2_badges');
    if(b) badges = new Set(JSON.parse(b));
    refreshBadges();
    // Check streak
    const today = new Date().toDateString();
    if(lastDate && lastDate !== today){
      const yest = new Date(); yest.setDate(yest.getDate()-1);
      if(lastDate !== yest.toDateString()){ streak=0; saveSt(); }
    }
  }catch(e){}
}

// =================================================================
// BRANCH / SUBJECTS
// =================================================================
function loadBranch(){
  const key = document.getElementById('branchSel').value;
  const d = BRANCHES[key];
  curSubjects = d.subjects.map(s=>({...s, lvl:'med'}));
  renderSubjList();
  populateFCSel();
}

function renderSubjList(){
  const c = document.getElementById('subjList'); c.innerHTML='';
  curSubjects.forEach((s,i)=>{
    const col = s.lvl==='low'?'#e50914': s.lvl==='high'?'#46d369':'#e8b708';
    const d = document.createElement('div');
    d.className = 'subj-row';
    d.innerHTML = `
      <div>
        <div class="sn">${s.name}</div>
        <div class="sc">Ù…Ø¹Ø§Ù…Ù„: ${s.coeff} Â· ${lblLvl(s.lvl)}</div>
      </div>
      <div class="pri-bar" style="background:${col}"></div>
      <select class="lvl-sel" onchange="setLvl(${i},this.value)">
        <option value="high" ${s.lvl==='high'?'selected':''}>ğŸŸ¢ Ø¬ÙŠØ¯</option>
        <option value="med"  ${s.lvl==='med' ?'selected':''}>ğŸŸ¡ Ù…ØªÙˆØ³Ø·</option>
        <option value="low"  ${s.lvl==='low' ?'selected':''}>ğŸ”´ Ø¶Ø¹ÙŠÙ</option>
      </select>`;
    c.appendChild(d);
  });
}

function lblLvl(l){ return{high:'Ø¬ÙŠØ¯',med:'Ù…ØªÙˆØ³Ø·',low:'Ø¶Ø¹ÙŠÙ'}[l]; }

function setLvl(i, v){
  curSubjects[i].lvl = v;
  renderSubjList();
}

// =================================================================
// PLAN GENERATION ALGORITHM
// =================================================================
function generatePlan(){
  const DAYS  = ['Ø§Ù„Ø³Ø¨Øª','Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø§Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©'];
  const SLOTS = [
    {time:'08:30 - 10:00', type:'morning',  ico:'ğŸŒ…'},
    {time:'10:15 - 11:45', type:'morning',  ico:'â˜€ï¸'},
    {time:'14:00 - 16:00', type:'afternoon',ico:'ğŸŒ¤ï¸'},
    {time:'16:30 - 18:00', type:'evening',  ico:'ğŸŒ†'}
  ];

  const LW = {high:1, med:2, low:3.5};

  // Score & frequency per subject
  const scored = curSubjects.map(s=>({
    ...s,
    score: s.coeff * LW[s.lvl],
    freq: Math.min(5, Math.max(1, Math.round(s.coeff * LW[s.lvl] / 4)))
  })).sort((a,b)=>{
    const R={low:3,med:2,high:1};
    return R[b.lvl]-R[a.lvl] || b.coeff-a.coeff;
  });

  // Build task pool
  let pool = [];
  scored.forEach(s=>{ for(let i=0;i<s.freq;i++) pool.push({...s}); });
  // Shuffle non-weak items
  const weak  = pool.filter(t=>t.lvl==='low');
  const other = pool.filter(t=>t.lvl!=='low');
  shuffle(other);
  pool = [...weak, ...other];

  // Track last-seen per slot to avoid back-to-back repeats
  const lastSeen = {};
  let pi = 0;

  function pick(slotKey){
    let best = null, tries = 0;
    while(tries < pool.length){
      const cand = pool[pi % pool.length];
      if(lastSeen[slotKey] !== cand.name){ best=cand; break; }
      pi++; tries++;
    }
    if(!best) best = pool[pi % pool.length];
    lastSeen[slotKey] = best.name;
    pi++;
    if(pi > pool.length*4){ pi=0; scored.forEach(s=>pool.push({...s})); }
    return best;
  }

  let html = '';
  DAYS.forEach((day, di)=>{
    html += `<div class="day-col"><div class="day-hdr"><span class="day-nm">${day}</span><span class="day-ct" id="dc${di}"></span></div>`;
    if(day==='Ø§Ù„Ø¬Ù…Ø¹Ø©'){
      html += `<div class="fri-card"><div style="font-size:1.5rem;margin-bottom:.4rem">ğŸ¯</div><div style="font-weight:700;color:var(--text);margin-bottom:.25rem">ÙŠÙˆÙ… Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©</div><div>ÙØ±ÙˆØ¶ Â· Ù…Ù„Ø®ØµØ§Øª Â· Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†Ø´Ø±Ø§Øª</div></div>`;
    } else {
      SLOTS.forEach((sl, si)=>{
        const t = pick(`${di}-${si}`);
        let mc='mm', method='ğŸ“ ØªÙ…Ø§Ø±ÙŠÙ† + Ù…Ø±Ø§Ø¬Ø¹Ø©';
        if(t.lvl==='low'){ mc='mh'; method = sl.type==='morning'?'âš ï¸ ÙÙ‡Ù… Ø£Ø³Ø§Ø³ÙŠ + ØªÙ…Ø§Ø±ÙŠÙ†':'âš ï¸ ØªØ±ÙƒÙŠØ² Ù…ÙƒØ«Ù‘Ù'; }
        else if(t.lvl==='high'){ mc='me'; method='âœ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ + Ù…ÙˆØ§Ø¶ÙŠØ¹ Ù‚Ø¯ÙŠÙ…Ø©'; }

        const tid = `t_${di}_${si}_${t.name.replace(/\s+/g,'_')}`;
        const st = tasks[tid]||{done:false,conf:0};

        let stars='';
        for(let s=1;s<=5;s++)
          stars+=`<span class="star${s<=st.conf?' lit':''}" onclick="rateStar('${tid}',${s})">â˜…</span>`;

        html += `
          <div class="slot${st.done?' done-slot':''}" id="c_${tid}">
            <div class="slot-time">${sl.ico} ${sl.time}</div>
            <div class="slot-subj">${t.name}</div>
            <div class="slot-method ${mc}">${method}</div>
            <div class="stars" id="stars_${tid}">${stars}</div>
            <div class="slot-acts">
              <button class="chk${st.done?' done':''}" id="chk_${tid}" onclick="toggleTask('${tid}','${t.name}')">${st.done?'âœ“':''}</button>
              <span id="lbl_${tid}" style="font-size:.63rem;color:${st.done?'var(--green)':'var(--muted)'}">${st.done?'âœ“ ØªÙ…Øª':'Ù„Ù… ØªÙÙ†Ø¬Ø²'}</span>
              <button class="pom-start" onclick="startPomFor('${t.name}')">â± Ø§Ø¨Ø¯Ø£</button>
            </div>
          </div>`;
      });
    }
    html += `</div>`;
  });

  document.getElementById('planGrid').innerHTML = html;
  planDone = true;
  updateProg();
  renderAnl();
  toast('inf','âš¡','ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø®Ø·Ø©!','Ø®Ø·ØªÙƒ Ø§Ù„Ø°ÙƒÙŠØ© Ù„Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø¬Ø§Ù‡Ø²Ø©');
}

function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}
  return arr;
}

// =================================================================
// TASK INTERACTIONS
// =================================================================
function toggleTask(id, subj){
  if(!tasks[id]) tasks[id]={done:false,conf:0,subj};
  tasks[id].done = !tasks[id].done;
  const chk = document.getElementById(`chk_${id}`);
  const lbl = document.getElementById(`lbl_${id}`);
  const card= document.getElementById(`c_${id}`);
  if(tasks[id].done){
    chk.classList.add('done'); chk.textContent='âœ“';
    card.classList.add('done-slot');
    lbl.style.color='var(--green)'; lbl.textContent='âœ“ ØªÙ…Øª';
    addXP(10);
    updateStreak();
    checkAch();
  } else {
    chk.classList.remove('done'); chk.textContent='';
    card.classList.remove('done-slot');
    lbl.style.color='var(--muted)'; lbl.textContent='Ù„Ù… ØªÙÙ†Ø¬Ø²';
    xp=Math.max(0,xp-10);
    updateXPUI();
  }
  saveSt(); updateProg();
}

function rateStar(id, n){
  if(!tasks[id]) tasks[id]={done:false,conf:0};
  tasks[id].conf=n;
  const c=document.getElementById(`stars_${id}`);
  if(c){ let h=''; for(let s=1;s<=5;s++) h+=`<span class="star${s<=n?' lit':''}" onclick="rateStar('${id}',${s})">â˜…</span>`; c.innerHTML=h; }
  if(n>=4){ addXP(5); toast('suc','â­','Ø«Ù‚Ø© Ø¹Ø§Ù„ÙŠØ©!',`${n} Ù†Ø¬ÙˆÙ… â€” Ø±Ø§Ø¦Ø¹! +5 XP`); }
  saveSt();
}

// =================================================================
// XP & LEVEL
// =================================================================
function addXP(n){
  xp+=n;
  const nl = Math.floor(xp/XPL)+1;
  if(nl>level){ level=nl; toast('ach','ğŸ‰',`Ù…Ø³ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯: ${level}!`,'ØªØ±Ù‚ÙŠØª Ø¥Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø£Ø¹Ù„Ù‰! ğŸš€'); }
  updateXPUI(); saveSt();
}
function updateXPUI(){
  const pct=(xp%XPL)/XPL*100;
  document.getElementById('lvlN').textContent=level;
  document.getElementById('xpTxt').textContent=`${xp} XP`;
  document.getElementById('xpFill').style.width=pct+'%';
}

// =================================================================
// STREAK
// =================================================================
function updateStreak(){
  const today = new Date().toDateString();
  if(lastDate!==today){ streak++; lastDate=today; toast('suc','ğŸ”¥',`${streak} ÙŠÙˆÙ… Ù…ØªÙˆØ§ØµÙ„!`,'ÙˆØ§ØµÙ„ Ø§Ù„Ø²Ø®Ù…!'); updateStrUI(); saveSt(); }
}
function updateStrUI(){ document.getElementById('strVal').textContent=streak; }

// =================================================================
// ACHIEVEMENTS
// =================================================================
const BADGELBL={
  'b-first':'Ø£ÙˆÙ„ Ø­ØµØ© Ù…ÙƒØªÙ…Ù„Ø© ğŸ¯','b-s3':'3 Ø£ÙŠØ§Ù… Ù…ØªØªØ§Ù„ÙŠØ© ğŸ”¥',
  'b-s7':'Ø£Ø³Ø¨ÙˆØ¹ ÙƒØ§Ù…Ù„ âš¡','b-half':'Ø§Ù„Ù†ØµÙ Ù…ÙƒØªÙ…Ù„ ğŸŒŸ',
  'b-full':'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ù…ÙƒØªÙ…Ù„ ğŸ‘‘','b-all':'ÙƒÙ„ Ø§Ù„Ù…ÙˆØ§Ø¯ ğŸ“š',
  'b-pom3':'3 Ø¬Ù„Ø³Ø§Øª Ø¨ÙˆÙ…ÙˆØ¯ÙˆØ±Ùˆ â±','b-fc10':'10 Ø¨Ø·Ø§Ù‚Ø§Øª Ù…Ø±Ø§Ø¬Ø¹Ø© ğŸƒ'
};

function checkAch(){
  const done = Object.values(tasks).filter(t=>t.done).length;
  const total = Object.keys(tasks).length;
  const study = new Set(Object.keys(tasks).filter(k=>tasks[k].done).map(k=>{const p=k.split('_');return p.slice(3).join('_');}));
  const checks={
    'b-first': done>=1,
    'b-s3': streak>=3,
    'b-s7': streak>=7,
    'b-half': total>0 && done/total>=.5,
    'b-full': total>0 && done===total,
    'b-all': study.size>=curSubjects.length,
    'b-pom3': pomCnt>=3,
    'b-fc10': fcTotal>=10
  };
  Object.entries(checks).forEach(([id,ok])=>{
    if(ok && !badges.has(id)){
      badges.add(id);
      const el=document.getElementById(id);
      if(el) el.classList.add('earned');
      toast('ach','ğŸ†','Ø¥Ù†Ø¬Ø§Ø² Ø¬Ø¯ÙŠØ¯!',BADGELBL[id]||id);
      saveSt();
    }
  });
}

function refreshBadges(){ badges.forEach(id=>{ const el=document.getElementById(id); if(el) el.classList.add('earned'); }); }

// =================================================================
// PROGRESS
// =================================================================
function updateProg(){
  const c=document.getElementById('progArea');
  const keys=Object.keys(tasks);
  const doneKeys=keys.filter(k=>tasks[k].done);
  const pct=keys.length?Math.round(doneKeys.length/keys.length*100):0;
  const sp={};
  curSubjects.forEach(s=>{sp[s.name]={t:0,d:0};});
  keys.forEach(id=>{
    const nm=id.split('_').slice(3).join('_').replace(/_/g,' ');
    if(sp[nm]){ sp[nm].t++; if(tasks[id].done) sp[nm].d++; }
  });
  let h=`<div class="stat-it">
    <div class="stat-hd"><span>Ø§Ù„ØªÙ‚Ø¯Ù… Ø§Ù„Ø¹Ø§Ù…</span><span class="stat-val">${pct}%</span></div>
    <div class="prog-bar"><div class="prog-fill" style="width:${pct}%;background:${pct>=75?'var(--green)':pct>=40?'var(--yellow)':'var(--red)'}"></div></div>
  </div>
  <div style="font-size:.72rem;color:var(--muted);text-align:center;margin:.3rem 0 .7rem">${doneKeys.length}/${keys.length} Ø­ØµØ© Ù…ÙƒØªÙ…Ù„Ø©</div>`;
  Object.entries(sp).forEach(([nm,d])=>{
    if(!d.t) return;
    const p=Math.round(d.d/d.t*100);
    const bg=p>=75?'var(--green)':p>=40?'var(--yellow)':'var(--red)';
    h+=`<div class="stat-it">
      <div class="stat-hd"><span style="font-size:.68rem">${nm.length>16?nm.slice(0,16)+'â€¦':nm}</span><span class="stat-val" style="font-size:.68rem">${p}%</span></div>
      <div class="prog-bar"><div class="prog-fill" style="width:${p}%;background:${bg}"></div></div>
    </div>`;
  });
  c.innerHTML=h;
  checkAch();
}

function resetProg(){
  if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØµÙÙŠØ± Ø§Ù„ØªÙ‚Ø¯Ù… ÙˆØ§Ù„Ø´Ø§Ø±Ø§ØªØŸ')){ tasks={}; badges.clear(); saveSt(); if(planDone)generatePlan(); updateProg(); refreshBadges(); toast('inf','â†©ï¸','ØªÙ… Ø§Ù„ØªØµÙÙŠØ±','Ø§Ø¨Ø¯Ø£ Ù…Ù† Ø¬Ø¯ÙŠØ¯!'); }
}

// =================================================================
// ANALYTICS
// =================================================================
function renderAnl(){
  const c=document.getElementById('anlGrid');
  const total=Object.keys(tasks).length;
  const done=Object.values(tasks).filter(t=>t.done).length;
  const avgC=total?( Object.values(tasks).reduce((a,t)=>a+(t.conf||0),0)/total ).toFixed(1):0;
  const sp={};
  curSubjects.forEach(s=>{sp[s.name]={sess:0,done:0};});
  Object.keys(tasks).forEach(id=>{
    const nm=id.split('_').slice(3).join('_').replace(/_/g,' ');
    if(sp[nm]){sp[nm].sess++;if(tasks[id].done)sp[nm].done++;}
  });
  const maxS=Math.max(...Object.values(sp).map(v=>v.sess),1);
  let barsH=Object.entries(sp).filter(([,d])=>d.sess>0).sort((a,b)=>b[1].sess-a[1].sess)
    .map(([nm,d])=>`<div class="bar-row"><div class="bar-lbl">${nm.length>10?nm.slice(0,10)+'â€¦':nm}</div><div class="bar-trk"><div class="bar-fill" style="width:${(d.sess/maxS)*100}%"></div></div><div class="bar-v">${d.sess}</div></div>`).join('');
  const cd=[0,0,0,0,0];
  Object.values(tasks).forEach(t=>{ if(t.conf>0) cd[t.conf-1]++; });
  let hm='';
  for(let i=0;i<35;i++){
    const r=Math.random();
    let cl=r>.7?'h4':r>.5?'h3':r>.3?'h2':r>.1?'h1':'';
    hm+=`<div class="hc ${cl}" title="ÙŠÙˆÙ… ${i+1}"></div>`;
  }
  c.innerHTML=`
    <div class="anl-card">
      <div class="anl-t">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</div>
      <div class="big-n">${total?Math.round(done/total*100):0}%</div>
      <div class="big-l">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:.7rem;margin-top:.9rem">
        <div style="background:var(--s3);padding:.55rem;border-radius:6px;text-align:center"><div style="font-size:1.25rem;font-weight:700;color:var(--green)">${done}</div><div style="font-size:.68rem;color:var(--muted)">Ø­ØµØµ Ù…ÙƒØªÙ…Ù„Ø©</div></div>
        <div style="background:var(--s3);padding:.55rem;border-radius:6px;text-align:center"><div style="font-size:1.25rem;font-weight:700;color:var(--yellow)">${avgC}</div><div style="font-size:.68rem;color:var(--muted)">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø«Ù‚Ø© â­</div></div>
      </div>
    </div>
    <div class="anl-card">
      <div class="anl-t">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­ØµØµ Ø¨Ø§Ù„Ù…ÙˆØ§Ø¯</div>
      ${barsH||'<p style="color:var(--muted);font-size:.78rem">Ù„Ø§ Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯ â€” ÙˆÙ„Ù‘Ø¯ Ø§Ù„Ø®Ø·Ø© Ø£ÙˆÙ„Ø§Ù‹</p>'}
    </div>
    <div class="anl-card">
      <div class="anl-t">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</div>
      ${['low','med','high'].map(l=>{
        const cnt=curSubjects.filter(s=>s.lvl===l).length;
        const bg={low:'var(--red)',med:'var(--yellow)',high:'var(--green)'}[l];
        const lb={low:'ğŸ”´ Ø¶Ø¹ÙŠÙ',med:'ğŸŸ¡ Ù…ØªÙˆØ³Ø·',high:'ğŸŸ¢ Ø¬ÙŠØ¯'}[l];
        return `<div class="bar-row"><div class="bar-lbl">${lb}</div><div class="bar-trk"><div class="bar-fill" style="width:${(cnt/curSubjects.length)*100}%;background:${bg}"></div></div><div class="bar-v">${cnt}</div></div>`;
      }).join('')}
    </div>
    <div class="anl-card">
      <div class="anl-t">Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù†Ø´Ø§Ø· (5 Ø£Ø³Ø§Ø¨ÙŠØ¹)</div>
      <div class="hm">${hm}</div>
      <div style="display:flex;gap:.4rem;align-items:center;margin-top:.45rem;font-size:.63rem;color:var(--muted)">
        <span>Ø£Ù‚Ù„</span><div class="hc"></div><div class="hc h1"></div><div class="hc h2"></div><div class="hc h3"></div><div class="hc h4"></div><span>Ø£ÙƒØ«Ø±</span>
      </div>
    </div>
    <div class="anl-card">
      <div class="anl-t">ØªÙˆØ²ÙŠØ¹ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø«Ù‚Ø©</div>
      <div style="display:flex;align-items:flex-end;gap:.4rem;height:75px;margin-top:.5rem">
        ${cd.map((n,i)=>{
          const mx=Math.max(...cd,1);
          const h=Math.round(n/mx*100);
          return `<div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px">
            <div style="font-size:.62rem;color:var(--muted)">${n}</div>
            <div style="height:${h}%;min-height:4px;width:100%;background:var(--red);border-radius:3px 3px 0 0;opacity:${.35+i*.14}"></div>
            <div style="font-size:.6rem;color:var(--muted)">${'â˜…'.repeat(i+1)}</div>
          </div>`;
        }).join('')}
      </div>
    </div>
    <div class="anl-card">
      <div class="anl-t">ØªÙ‚Ø¯Ù… Ø§Ù„Ù€ XP</div>
      <div class="big-n">${xp}</div>
      <div class="big-l">Ù†Ù‚Ø·Ø© Ø®Ø¨Ø±Ø© Ù…ÙƒØªØ³Ø¨Ø©</div>
      <div style="margin-top:.75rem">
        <div style="font-size:.68rem;color:var(--muted);margin-bottom:3px">Niv.${level} â†’ ${level+1}</div>
        <div class="prog-bar"><div class="prog-fill" style="width:${(xp%XPL)/XPL*100}%;background:var(--red)"></div></div>
        <div style="font-size:.68rem;color:var(--muted);margin-top:3px">${XPL-(xp%XPL)} XP Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ§Ù„ÙŠ</div>
      </div>
    </div>`;
}

// =================================================================
// FLASHCARDS
// =================================================================
function populateFCSel(){
  const sel=document.getElementById('fcSel');
  sel.innerHTML='<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø§Ø¯Ø©...</option>';
  curSubjects.forEach(s=>{
    if(FCDB[s.name]) sel.innerHTML+=`<option value="${s.name}">${s.name} (${FCDB[s.name].length} Ø¨Ø·Ø§Ù‚Ø©)</option>`;
  });
}

function loadFC(){
  const s=document.getElementById('fcSel').value;
  if(!s||!FCDB[s]){ document.getElementById('fcArea').innerHTML='<div class="empty"><div class="empty-ico">ğŸƒ</div><div>Ø§Ø®ØªØ± Ù…Ø§Ø¯Ø©</div></div>'; return; }
  curFC=[...FCDB[s]]; fcIdx=0; fcKnown=0;
  renderFC();
}

function shuffleFC(){ if(!curFC.length) return; shuffle(curFC); fcIdx=0; renderFC(); toast('inf','ğŸ”€','ØªÙ… Ø§Ù„Ø®Ù„Ø·','ØªØ±ØªÙŠØ¨ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø¨Ø·Ø§Ù‚Ø§Øª!'); }

function resetFC(){ if(!curFC.length) return; fcIdx=0; fcKnown=0; renderFC(); }

function renderFC(){
  const area=document.getElementById('fcArea');
  if(!curFC.length){ area.innerHTML='<div class="empty"><div class="empty-ico">ğŸƒ</div><div>Ø§Ø®ØªØ± Ù…Ø§Ø¯Ø©</div></div>'; return; }
  document.getElementById('fcProg').textContent=`${fcIdx+1} / ${curFC.length} | âœ“ ${fcKnown}`;
  const card=curFC[fcIdx];
  const subj=document.getElementById('fcSel').value;
  area.innerHTML=`
    <div class="fc-scene" onclick="flipFC(this)">
      <div class="fc-card" id="fcCard">
        <div class="fc-face fc-front">
          <div class="fc-hint">Ø§Ù†Ù‚Ø± Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ø§Ù„Ø¬ÙˆØ§Ø¨ ğŸ‘‡</div>
          <div class="fc-q">${card.q}</div>
          <div class="fc-tag">${subj}</div>
        </div>
        <div class="fc-face fc-back">
          <div class="fc-hint">âœ… Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</div>
          <div class="fc-ans">${card.a}</div>
        </div>
      </div>
    </div>
    <div class="fc-acts">
      <button class="btn-fc btn-no" onclick="fcAns(false)">âŒ Ù„Ù… Ø£Ø¹Ø±Ù</button>
      <button class="btn-fc btn-yes" onclick="fcAns(true)">âœ… Ø¹Ø±ÙØª!</button>
    </div>
    <div class="fc-nav">
      <button class="btn-nav" onclick="fcStep(1)">â€¹</button>
      <span class="fc-ct">${fcIdx+1} / ${curFC.length}</span>
      <button class="btn-nav" onclick="fcStep(-1)">â€º</button>
    </div>`;
}

function flipFC(sc){ sc.querySelector('.fc-card').classList.toggle('flipped'); }

function fcAns(known){
  if(known){ fcKnown++; fcTotal++; addXP(5); toast('suc','âœ…','Ù…Ù…ØªØ§Ø²!','+5 XP'); checkAch(); }
  fcIdx=(fcIdx+1)%curFC.length;
  renderFC();
}

function fcStep(d){ fcIdx=(fcIdx+d+curFC.length)%curFC.length; renderFC(); }

// =================================================================
// POMODORO
// =================================================================
const FOCUS=25*60, BREAK=5*60;

function togglePom(){ document.getElementById('pomPanel').classList.toggle('open'); }
function startPomFor(subj){ document.getElementById('pomPanel').classList.add('open'); document.getElementById('pomMode').textContent=`ğŸ§  ${subj}`; pomReset(); toast('inf','â±',`Ù…Ø¤Ù‚Øª: ${subj}`,'25 Ø¯Ù‚ÙŠÙ‚Ø© ØªØ±ÙƒÙŠØ² â€” Ù‡ÙŠØ§!'); }

function pomToggle(){ pomAct?pomPause():pomStart(); }

function pomStart(){
  pomAct=true;
  const btn=document.getElementById('pomSBtn');
  btn.textContent='â¸ Ø¥ÙŠÙ‚Ø§Ù'; btn.classList.add('pulsing');
  pomTimer=setInterval(()=>{
    pomSec--;
    updatePomUI();
    if(pomSec<=0){
      clearInterval(pomTimer); pomAct=false;
      btn.textContent='â–¶ Ø§Ø¨Ø¯Ø£'; btn.classList.remove('pulsing');
      if(!pomBreak){
        pomCnt++; saveSt();
        addXP(25);
        toast('ach','ğŸ‰',`Ø¨ÙˆÙ…ÙˆØ¯ÙˆØ±Ùˆ ${pomSess} Ù…ÙƒØªÙ…Ù„!`,'+25 XP ğŸ”¥');
        pomBreak=true; pomSec=BREAK; pomSess++;
        document.getElementById('pomMode').textContent='â˜• Ø§Ø³ØªØ±Ø§Ø­Ø©!';
        document.getElementById('pomSess').textContent=`Ø§Ù„Ø¬Ù„Ø³Ø© ${pomSess} Ù…Ù† 4`;
        checkAch();
      } else {
        toast('inf','ğŸ§ ','Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø§Ø³ØªØ±Ø§Ø­Ø©!','Ø¬Ù„Ø³Ø© ØªØ±ÙƒÙŠØ² Ø¬Ø¯ÙŠØ¯Ø©...');
        pomBreak=false; pomSec=FOCUS;
        document.getElementById('pomMode').textContent='ğŸ§  ÙˆÙ‚Øª Ø§Ù„ØªØ±ÙƒÙŠØ²';
      }
      updatePomUI();
    }
  },1000);
}

function pomPause(){ clearInterval(pomTimer); pomAct=false; const btn=document.getElementById('pomSBtn'); btn.textContent='â–¶ Ø§Ø³ØªÙ…Ø±'; btn.classList.remove('pulsing'); }

function pomReset(){
  clearInterval(pomTimer); pomAct=false; pomBreak=false; pomSec=FOCUS; pomSess=1;
  const btn=document.getElementById('pomSBtn'); btn.textContent='â–¶ Ø§Ø¨Ø¯Ø£'; btn.classList.remove('pulsing');
  document.getElementById('pomMode').textContent='ğŸ§  ÙˆÙ‚Øª Ø§Ù„ØªØ±ÙƒÙŠØ²';
  document.getElementById('pomSess').textContent='Ø§Ù„Ø¬Ù„Ø³Ø© 1 Ù…Ù† 4';
  updatePomUI();
}

function updatePomUI(){
  const m=Math.floor(pomSec/60), s=pomSec%60;
  document.getElementById('pomTime').textContent=`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  const total=pomBreak?BREAK:FOCUS;
  const off=CIRC*(1-pomSec/total);
  const ring=document.getElementById('pomRing');
  ring.style.strokeDashoffset=off;
  ring.style.stroke=pomBreak?'var(--green)':'var(--red)';
}

// =================================================================
// TABS
// =================================================================
function switchTab(id, btn){
  document.querySelectorAll('.tab-pane').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById(`tab-${id}`).classList.add('active');
  btn.classList.add('active');
  if(id==='analytics') renderAnl();
  if(id==='flashcards') populateFCSel();
}

// =================================================================
// QUOTES
// =================================================================
function rotateQuote(){
  const el=document.getElementById('quoteText');
  if(!el) return;
  el.style.opacity='0';
  setTimeout(()=>{ el.textContent=QUOTES[Math.floor(Math.random()*QUOTES.length)]; el.style.opacity='1'; },500);
}

// =================================================================
// TOAST
// =================================================================
function toast(type, ico, title, msg){
  const ct=document.getElementById('toastCt');
  const t=document.createElement('div');
  t.className=`toast ${type}`;
  t.innerHTML=`<span class="toast-ico">${ico}</span><div><div class="toast-t">${title}</div><div class="toast-m">${msg}</div></div>`;
  ct.appendChild(t);
  setTimeout(()=>{ t.style.opacity='0'; t.style.transform='translateY(-10px)'; t.style.transition='all .4s'; setTimeout(()=>t.remove(),400); },3200);
}

// =================================================================
// START
// =================================================================
init();
</script>
</body>
</html>
